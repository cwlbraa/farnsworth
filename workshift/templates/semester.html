{% extends "w_base.html" %}

{% load static from staticfiles %}
{% load request_tags %}
{% load bootstrap %}
{% load workshift_tags %}

{% block w_headers %}
{% endblock %}

{% block w_content %}
<div class="row">
  <div class="col-sm-1 col-xs-2 text-left">
	{% if prev_day %}
	<a title="Previous day" class="day_control" href="{% wurl 'workshift:view_semester' sem_url=SEMESTER.sem_url %}?day={{ prev_day }}">
	  <span class="glyphicon glyphicon-chevron-left"></span>
	</a>
	{% endif %}
  </div> <!-- .col-xs-1 -->
  <h3 id="day_title" class="col-sm-10 col-xs-8 text-center w_subtitle"><span class="hidden-xs w_subtitle">Workshifts
	  for {{ day|date:"l, F d, Y" }}</span><span class="visible-xs w_subtitle">{{ day|date:"D., N d, Y" }}</span></h3>
  <div class="col-sm-1 col-xs-2 text-right">
	{% if next_day %}
	<a title="Next day" class="day_control" href="{% wurl 'workshift:view_semester' sem_url=SEMESTER.sem_url %}?day={{ next_day }}">
	  <span class="glyphicon glyphicon-chevron-right"></span>
	</a>
	{% endif %}
  </div> <!-- .col-sm-1 -->
</div> <!-- .row -->
<div class="workshift_table">
  <table class="workshift_inner table table-striped table-bordered table-condensed table-hover">
	<thead>
	  <tr>
		<th>Title</th>
		<th>Time</th>
		<th>Hours</th>
		<th>Workshifter</th>
		<th>Verifier</th>
		<th>Action</th>
	  </tr>
	</thead>
	<tbody>
	  {% for shift, forms in day_shifts %}
	  <tr>
		<td>
		  <a href="{% wurl 'workshift:view_instance' sem_url=SEMESTER.sem_url pk=shift.pk %}">{{ shift.title }}</a>
		</td>
		<td>
		  {% if shift.start_time %}
		  {{ shift.start_time }}
		  {% if shift.end_time %} - {{ shift.end_time }}{% endif %}
		  {% endif %}
		</td>
		<td>
		  {% if shift.intended_hours == shift.hours %}
		  {{ shift.hours }}
		  {% else %}
		  <del>{{ shift.intended_hours}}</del> {{ shift.hours }}
		  {% endif %}
		</td>
		<td>
		  {% if shift.workshifter %}
		  <a href="{% wurl 'workshift:profile' sem_url=SEMESTER.sem_url targetUsername=shift.workshifter.user.username %}">{{ shift.workshifter.user.get_full_name }}</a>
		  {% endif %}
		</td>
		<td>
		  {% if shift.blown %}
		  <font color="red">BLOWN</font>
		  {% elif shift.verifier %}
		  <a href="{% wurl 'workshift:profile' sem_url=SEMESTER.sem_url targetUsername=shift.verifier.user.username %}">{{ shift.verifier.user.get_full_name }}</a>
		  {% endif %}
		</td>
		<td>
		  {% for form in forms %}
		  <form style="display:inline" method="POST">
			{% csrf_token %}
			{{ form }}
			<button type="submit" class="btn btn-xs" name="{{ form.action_name }}">
			  <span class="visible-xs">{{ form.title_short }}</span>
			  <span class="hidden-xs">{{ form.title_long }}</span>
			</button>
		  </form>
		  {% endfor %}
		</td>
	  </tr>
	  {% endfor %}
	</tbody>
  </table>
</div> <!-- .workshift_table -->
{% if week_shifts %}
<br/>
<div class="workshift_week_table">
  <h3 class="w_title">Workshifts for this week</h3>
  <table class="workshift_inner table table-striped table-bordered table-condensed table-hover">
	<thead>
	  <tr>
		<th>Title</th>
		<th>Hours</th>
		<th>Workshifter</th>
		<th>Verifier</th>
		<th>Action</th>
	  </tr>
	</thead>
	<tbody>
	  {% for shift, forms in week_shifts %}
	  <tr>
		<td>
		  <a href="{% wurl 'workshift:view_instance' sem_url=SEMESTER.sem_url pk=shift.pk %}">{{ shift.title }}</a>
		</td>
		<td>
		  {% if shift.intended_hours == shift.hours %}
		  {{ shift.hours }}
		  {% else %}
		  <del>{{ shift.intended_hours}}</del> {{ shift.hours }}
		  {% endif %}
		</td>
		<td>
		  {% if shift.workshifter %}
		  <a href="{% wurl 'workshift:profile' sem_url=SEMESTER.sem_url targetUsername=shift.workshifter.user.username %}">{{ shift.workshifter.user.get_full_name }}</a>
		  {% endif %}
		</td>
		<td>
		  {% if shift.blown %}
		  <font color="red">BLOWN</font>
		  {% elif shift.auto_verify %}
		  Auto Verify
		  {% elif shift.verifier %}
		  <a href="{% wurl 'workshift:profile' sem_url=SEMESTER.sem_url targetUsername=shift.verifier.user.username %}">{{ shift.verifier.user.get_full_name }}</a>
		  {% endif %}
		</td>
		<td>
		  {% for form in forms %}
		  <form style="display:inline" method="POST">
			{% csrf_token %}
			{{ form }}
			<button type="submit" class="btn btn-xs" name="{{ form.action_name }}">
			  <span class="visible-xs">{{ form.title_short }}</span>
			  <span class="hidden-xs">{{ form.title_long }}</span>
			</button>
		  </form>
		  {% endfor %}
		</td>
	  </tr>
	  {% endfor %}
	</tbody>
  </table>
</div> <!-- .workshift_week_table -->
{% endif %}
{% endblock %}

{% block w_endscripts %}
<script>
$(document).ready(function() {
	$('table').tablesorter({
		sortList: [[1, 0], [0,0]]
		});
	});
</script>
{% endblock %}
