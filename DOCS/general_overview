Project: Farnsworth
Author: Karandeep Singh Nagra

Description
==
An online gathering place for each house in the BSC.  Scalable and modular,
intended to be used as an instance at each house.
No authorship claim is made to the contents of the subdirectories
tinymce, jquery, and bootstrap of directory static, with the exception of the file
static/tinymce/layout.js.  Please consult the relevant licenses before distributing
or using those portions of this software.

Logos included in the /static/ui/images/oauth are property and copyright of the
respective companies.

Dependencies
==
Django 1.6.5
Python 2.7.3
SQLite3 (for running tests)
TinyMCE 4.0.21 (included in static folder)
jQuery 1.11.0 (included in static/jquery folder)
tablesorter 2.15.13 (included in static/jquery folder)
Nivo Slider 3.2 (included in static/jquery folder)
django-bootstrap-form 3.1
moment.js (included in static folder)
bootstrap-datetime-picker (included in static/bootstrap/js and static/ui/css)
Django-Haystack 2.1.1-dev (from GitHub, read 'Get started' on haystacksearch.org)
elasticsearch 1.1.1 (https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.1.1.deb)
Python elasticsearch (pip install elasticsearch)
Python Social Auth 0.1.23

Deployment
==

System Packages
===
On CentOS:
  
    $ sudo yum install postgres python python-devel virtualenv gcc mod_wsgi

On Debian:

    $ sudo apt-get install postgres python python-devel virtualenv gcc libapache2-mod-wsgi

See http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup-repositories.html on installing elasticsearch on either distribution.

Apache
===
Add the following lines to the httpd.conf file for Apache:
  
    WSGIScriptAlias /farnsworth /path/to/farnsworth/farnsworth/wsgi.py
    WSGIPythonPath /path/to/farnsworth:/path/to/farnsworth/lib/python<python-version>/site-packages
    Alias /static/ /path/to/farnsworth/static/

    <Directory /path/to/farnsworth/farnsworth>
      <Files wsgi.py>
        Order deny,allow
        Allow from all
      </Files>
    </Directory>

virtualenv
===

    $ cd /path/to/farnsworth
    $ virtualenv .
    $ source bin/activate
    $ pip install django django-bootstrap-form psycopg2 python-social-auth elasticsearch
    $ pip install -e git://github.com/toastdriven/django-haystack.git#egg=django_haystack-master

PostgreSQL
===
    $ sudo su - postgres
    $ createdb <house>
    $ createuser -PS <house>_admin
    $ psql
    postgres=# GRANT ALL PRIVILEGES ON DATABASE <house> TO <house>_admin;

SELinux
===

For PostgreSQL

    # setsebool -P httpd_can_network_connect_db 1

For elasticsearch:

    # setsebool -P httpd_can_network_connect on

Backups
==
SQLite
===
Simply copy and compress the SQLite database file:

    $ gzip farnsworth/<house>.db > "backup-<house>-$(date +%F).db.gz"

And restore by decompressing and copying back:

    $ gunzip backup-<house>-<date>.db.gz > farnsworth/<house>.db

PostgreSQL
===

Back up the house's database with the following command:

    $ pg_dump -U <house>_admin <house> | gzip > "backup-<house>-$(date +%F).db.gz"

Restore the house's database with the following command:

    $ gunzip -c backup-<house>-<date>.db.gz | psql -U <house>_admin <house>

See http://www.postgresql.org/docs/current/static/backup.html for a detailed description of other methods to back up the database.
