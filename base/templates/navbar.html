{% load notifications_tags %}
<div class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 10px;">
<div class="container">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" title="Home" href="{% url 'homepage' %}"><span class="glyphicon glyphicon-home"></span> {{ SHORT_HOUSE }}</a>
  </div> <!-- .navbar-header -->
  <div class="collapse navbar-collapse">
  <!-- class="active" ??? -->
  {% if user.is_authenticated %}
    <ul class="nav navbar-nav">
      {% if user.username == ANONYMOUS_USERNAME %}
        <li><a title="Logged in as anonymous user {{ user.first_name }} {{ user.last_name }}. Click to temporarily login as yourself or request an account." style="color: #ff0000 !important;" href="{% url 'login' %}"><span class="glyphicon glyphicon-exclamation-sign"></span> Login</a></li>
      {% else %}
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"{% if ANONYMOUS_SESSION %} style="color: #ff0000 !important;" title='This is a temporary session.  When you logout, the anonymous user "{{ ANONYMOUS_USERNAME }}" will be logged in.'{% endif %}><span class="glyphicon glyphicon-user"></span> {{ user.first_name }} <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href="{% url 'threads:list_user_threads' targetUsername=user.username %}" ><span class="glyphicon glyphicon-comment"></span> My Threads</a></li>
          <li><a href="{% url 'threads:list_user_messages' targetUsername=user.username %}" ><span class="glyphicon glyphicon-paperclip"></span> My Messages</a></li>
          <li><a href="{% url 'managers:list_user_requests' targetUsername=user.username %}" ><span class="glyphicon glyphicon-inbox"></span> My Requests</a></li>
          <li class="divider"></li>
          {% if WORKSHIFT_PROFILE %}
          <li><a href="{% url 'workshift:profile' targetUsername=WORKSHIFT_PROFILE.user.username %}" >{% if STANDING %}<span title="{% if STANDING > 0 or STANDING == 0 %}Up{% else %}Down{% endif %} {{ STANDING }} hours" class="badge {% if STANDING > 0 or STANDING == 0 %}alert-success{% else %}alert-danger{% endif %} pull-right">{% if STANDING > 0 or STANDING = 0 %}+{% endif %}{{ STANDING }}</span>
              {% endif %}<span class="glyphicon glyphicon-dashboard"></span> Workshift Dashboard</a></li>
          {% endif %}
          <li><a href="{% url 'my_profile' %}" ><span class="glyphicon glyphicon-edit"></span> Update My Profile</a></li>
          <li>{% notifications_unread as unread_count %}
            <a href="{% url 'notifications' %}"
              title="{{ unread_count }} unread notification{{ unread_count|pluralize }}">
                {% if unread_count > 0 %}<span class="badge pull-right">{{ unread_count }}</span>{% endif %}
                <span class="glyphicon glyphicon-bell"></span>
                Notifications
            </a>
          </li>
          <li class="divider"></li>
          <li><a class="menu_link" href="{% url 'logout' %}"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
        </ul> <!-- .dropdown-menu -->
      </li> <!-- .dropdown -->
      {% endif %} {% comment %} End if user.username == ANONYMOUS_USERNAME, else {% endcomment %}
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-tower"></span> Managers <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="{% url 'managers:list_managers' %}" ><span class="glyphicon glyphicon-book"></span> Manager Directory</a></li>
        <li><a href="{% url 'managers:announcements' %}" ><span class="glyphicon glyphicon-bullhorn"></span> Announcements</a></li>
          {% if REQUEST_TYPES %}
          <li class="divider"></li>
          <li class="dropdown-header">Requests</li>
        {% for type_tuple in REQUEST_TYPES %}
          <li><a href="{% url 'managers:requests' requestType=type_tuple.0.url_name %}" ><span title="{{ type_tuple.1 }} open request{{ type_tuple.1|pluralize }}" class="badge pull-right">{% if type_tuple.1 > 0 %}{{ type_tuple.1 }}{% endif %}</span>
          <span class="glyphicon glyphicon-{% if type_tuple.0.glyphicon %}{{ type_tuple.0.glyphicon }}{% else %}inbox{% endif %}"></span>
          {{ type_tuple.0.name }}</a></li>
        {% endfor %}
          {% endif %} {% comment %} End if REQUEST_TYPES {% endcomment %}
        </ul> <!-- .dropdown-menu -->
      </li>
     <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-arrow-right"></span> Go<b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href="{% url 'member_directory' %}" ><span class="glyphicon glyphicon-book"></span> Member Directory</a></li>
        <li><a href="{% url 'events:list' %}" ><span class="glyphicon glyphicon-calendar"></span> Upcoming Events</a></li>
        <li><a href="{% url 'rooms:list' %}" ><span class="glyphicon glyphicon-home"></span> Room List</a></li>
        {% if WORKSHIFT_PROFILE %}
        <li class="divider"></li>
        <li class="dropdown-header">Workshift</li>
        <li><a href="{% url 'workshift:view_semester' %}" ><span class="glyphicon glyphicon-list-alt"></span> Workshift Board</a></li>
        <li><a href="{% url 'workshift:profiles' %}" ><span class="glyphicon glyphicon-tasks"></span> Standings</a></li>
        <li><a href="{% url 'workshift:list_types' %}" ><span class="glyphicon glyphicon-align-justify"></span> All Shifts</a></li>
        {% endif %}
        <li class="divider"></li>
        <li class="dropdown-header">Utilities</li>
        <li><a class="menu_link" href="{% url 'helppage' %}"><span class="glyphicon glyphicon-question-sign"></span> How To</a></li>
	    <li><a class="menu_link" href="{% url 'bylaws' %}"><span class="glyphicon glyphicon-flag"></span> House Bylaws</a></li>
        <li><a class="menu_link" id="sub_menu_display" href="{% url 'site_map' %}" ><span class="glyphicon glyphicon-map-marker"></span> Site Map</a></li>
        <li><a href="{% url 'external' %}"><span class="glyphicon glyphicon-plane"></span> Landing</a></li>
        <li><a href="{% url 'archives' %}" ><span class="glyphicon glyphicon-hdd"></span> Archives</a></li>
        <li class="divider"></li>
        <li><a href="https://github.com/knagra/farnsworth" target="_blank" ><span class="glyphicon glyphicon-info-sign"></span> Source</a></li>
	    <li><a href="/internal_archive/kwiki/toadish_definitions" target="_blank" ><span class="glyphicon glyphicon-heart"></span> Toadish</a></li>
      </ul> <!-- .dropdown-menu -->
     </li> <!-- .dropdown -->
      {% if user.is_superuser or PRESIDENT or WORKSHIFT_MANAGER%}
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span> Admin <b class="caret"></b></a>
        <ul class="dropdown-menu">
        {% if user.is_superuser %}
        <li class="dropdown-header">Users</li>
        <li><a href="{% url 'custom_manage_users' %}" ><span class="glyphicon glyphicon-user"></span> Manage Users</a></li>
        <li><a href="{% url 'custom_add_user' %}" ><span class="glyphicon glyphicon-plus"></span> Add User</a></li>
        <li><a href="{% url 'manage_profile_requests' %}"><span title="{{ NUM_OF_PROFILE_REQUESTS }} open profile request{{ NUM_OF_PROFILE_REQUESTS|pluralize }}" class="badge pull-right">{% if NUM_OF_PROFILE_REQUESTS > 0 %}{{ NUM_OF_PROFILE_REQUESTS }}{% endif %}</span>
          <span class="glyphicon glyphicon-inbox"></span> Profile Requests</a></li>
        <li class="divider"></li>
        {% endif %}
        {% if user.is_superuser or PRESIDENT %}
        <li class="dropdown-header">President</li>
        <li><a href="{% url 'managers:meta_manager' %}"><span class="glyphicon glyphicon-tower"></span> Meta-Manager</a></li>
        <li><a href="{% url 'managers:manage_request_types' %}"><span class="glyphicon glyphicon-inbox"></span> Manage Request Types</a></li>
        <li class="divider"></li>
        {% endif %}
        {% if user.is_superuser or WORKSHIFT_MANAGER %}
        <li class="dropdown-header">Workshift Manager</li>
        {% if CURRENT_SEMESTER %}
        <li><a href="{% url 'workshift:manage' %}"><span class="glyphicon glyphicon-adjust"></span> Manage</a></li>
        {% else %}
        <li><a href="{% url 'workshift:start_semester' %}"><span class="glyphicon glyphicon-plus"></span> Start Semester</a></li>
        {% endif %}
        {% endif %}
        {% if user.is_superuser %}
        <li class="divider"></li>
        <li class="dropdown-header">Miscellaneous</li>
        <li><a href="{% url 'utilities' %}"><span class="glyphicon glyphicon-wrench"></span> Site Utilities</a></li>
        {% endif %}
        </ul> <!-- .dropdown-menu -->
      </li>
      {% endif %} {% comment %} end if user.is_superuser {% endcomment %}
      </ul> <!-- .navbar-nav -->
        <div style="padding: 0px;" class="col-sm-3 col-md-4 pull-right">
          <form id="search_bar" class="navbar-form" role="search" action="{% url 'haystack_search' %}?q=" style="padding-left: 5px; padding-right: 5px;">
          <div class="input-group">
            <input type="search" class="form-control search-query" name="q" placeholder="Search">
            <span class="input-group-btn">
              <button type="submit" class="btn btn-info"><span class="glyphicon glyphicon-search"></span></button>
            </span>
          </div> <!-- .input-group -->
          </form>
        </div> <!-- .col-sm-3 -->
  {% else %}
    <ul class="nav navbar-nav navbar-right">
      <li><a class="menu_link" href="{% url 'login' %}"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
      <li><a class="menu_link" href="{% url 'request_profile' %}"><span class="glyphicon glyphicon-leaf"></span> Request Account</a></li>
      <li><a class="menu_link" href="https://github.com/knagra/farnsworth" target="_blank" ><span class="glyphicon glyphicon-info-sign"></span> Source</a></li>
      <li><a class="menu_link" href="{% url 'helppage' %}"><span class="glyphicon glyphicon-question-sign"></span> Help</a></li>
      <li><a class="menu_link" id="sub_menu_display" href="{% url 'site_map' %}" ><span class="glyphicon glyphicon-map-marker"></span> Site Map</a></li>
    </ul> <!-- .navbar-right -->
  {% endif %} {% comment %} End if user.is_authenticated, else {% endcomment %}
  </div> <!-- .navbar-collapse -->
</div> <!-- .container -->
</div> <!-- .navbar -->
